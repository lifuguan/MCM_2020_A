%% ???????????��??????
% ??????????????????????????:
%
%    C:\Users\10027\Desktop\MCM_2020_A\a_resources\HadISST1_SST_2007.txt
%
% ???????????????????????????????????????????????????????

% ?? MATLAB ????????? 2020/02/14 22:12:35

%% ???????????
filename = 'C:\Users\10027\Desktop\MCM_2020_A\a_resources\HadISST1_SST_2007.txt';

%% ?????????????????:
% ?��?????????????? TEXTSCAN ?????
formatSpec = '%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%12s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%6s%s%[^\n\r]';

%% ??????????
fileID = fopen(filename,'r');

%% ??????????????��?
% ??????????????????????????????????????????????????????????????????????
dataArray = textscan(fileID, formatSpec, 'Delimiter', '', 'WhiteSpace', '', 'TextType', 'string',  'ReturnOnError', false);

%% ???????????
fclose(fileID);

%% ?????????????????????????????
% ???????????�I? NaN??
raw = repmat({''},length(dataArray{1}),length(dataArray)-1);
for col=1:length(dataArray)-1
    raw(1:length(dataArray{col}),col) = mat2cell(dataArray{col}, ones(length(dataArray{col}), 1));
end
numericData = NaN(size(dataArray{1},1),size(dataArray,2));

for col=[170,171,172,173,174,175,176,177,178,179,180,181,182,183]
    % ??????????????��?????????????????????????�I? NaN??
    rawData = dataArray{col};
    for row=1:size(rawData, 1)
        % ????????????????????????????????
        regexstr = '(?<prefix>.*?)(?<numbers>([-]*(\d+[\,]*)+[\.]{0,1}\d*[eEdD]{0,1}[-+]*\d*[i]{0,1})|([-]*(\d+[\,]*)*[\.]{1,1}\d+[eEdD]{0,1}[-+]*\d*[i]{0,1}))(?<suffix>.*)';
        try
            result = regexp(rawData(row), regexstr, 'names');
            numbers = result.numbers;
            
            % ????�˦�???��???????
            invalidThousandsSeparator = false;
            if numbers.contains(',')
                thousandsRegExp = '^[-/+]*\d+?(\,\d{3})*\.{0,1}\d*$';
                if isempty(regexp(numbers, thousandsRegExp, 'once'))
                    numbers = NaN;
                    invalidThousandsSeparator = true;
                end
            end
            % ?????????????????
            if ~invalidThousandsSeparator
                numbers = textscan(char(strrep(numbers, ',', '')), '%f');
                numericData(row, col) = numbers{1};
                raw{row, col} = numbers{1};
            end
        catch
            raw{row, col} = rawData{row};
        end
    end
end


%% ???????????�I? NaN
R = cellfun(@(x) ~isnumeric(x) && ~islogical(x),raw); % ???????????
raw(R) = {NaN}; % ?�I????????

%% ???????????
HadISST1_SST_2007 = table;

HadISST1_SST_2007.VarName170 = cell2mat(raw(26:41, 170)) / 100;
HadISST1_SST_2007.VarName171 = cell2mat(raw(26:41, 171)) / 100;
HadISST1_SST_2007.VarName172 = cell2mat(raw(26:41, 172)) / 100;
HadISST1_SST_2007.VarName173 = cell2mat(raw(26:41, 173)) / 100;
HadISST1_SST_2007.VarName174 = cell2mat(raw(26:41, 174)) / 100;
HadISST1_SST_2007.VarName175 = cell2mat(raw(26:41, 175)) / 100;
HadISST1_SST_2007.VarName176 = cell2mat(raw(26:41, 176)) / 100;
HadISST1_SST_2007.VarName177 = cell2mat(raw(26:41, 177)) / 100;
HadISST1_SST_2007.VarName178 = cell2mat(raw(26:41, 178)) / 100;
HadISST1_SST_2007.VarName179 = cell2mat(raw(26:41, 179)) / 100;
HadISST1_SST_2007.VarName180 = cell2mat(raw(26:41, 180)) / 100;
HadISST1_SST_2007.VarName181 = cell2mat(raw(26:41, 181)) / 100;
HadISST1_SST_2007.VarName182 = cell2mat(raw(26:41, 182)) / 100;
HadISST1_SST_2007.VarName183 = cell2mat(raw(26:41, 183)) / 100;



%% ??????????
clearvars filename formatSpec fileID dataArray ans raw col numericData rawData row regexstr result numbers invalidThousandsSeparator thousandsRegExp R;